from turtle import Turtle, Screen

FONT = ("Sans", 18, "normal")

def isCollision(t1, t2):
    return t1.distance(t2) < 20

# Создадим окно
screen = Screen()
screen.bgcolor("Black")
screen.title("Пинг-Понг")

# Создадим границы игрового поля
border_pen = Turtle(visible=False)
border_pen.speed('fastest')
border_pen.color('Yellow')
border_pen.pensize(3)

border_pen.penup()
border_pen.setposition(-300, -300)
border_pen.pendown()

for _ in range(4):
    border_pen.forward(600)
    border_pen.left(90)

# Поставить счетчик счета на 0
score = 0

# Установить время на 0
seconds = 0

# Написать счет
score_pen = Turtle(visible=False)
score_pen.color("Red")
score_pen.penup()
score_pen.setposition(-290, 310)

score_pen.write("Score {}".format(score), False, align="left", font=FONT)

# Нарисовать таймер
time_pen = Turtle(visible=False)
time_pen.color("white")
time_pen.penup()
time_pen.setposition(220, 310)

time_pen.write("Time {}".format(int(seconds)), False, align="left", font=FONT)

# Создаем игрока
player = Turtle("square", visible=False)
player.shapesize(0.5, 3)
player.speed('fastest')
player.setheading(90)
player.color("blue")
player.penup()

player.setposition(-280, -250)  # (x,y)
player.showturtle()

playerspeed = 50

# Создаем игрока, управляемого компьютером
AIplayer = Turtle("square", visible=False)
AIplayer.shapesize(0.5, 3)
AIplayer.speed('fastest')
AIplayer.setheading(90)
AIplayer.color("Green")
AIplayer.penup()

AIplayer.setposition(280, 250)  # (x,y)
AIplayer.showturtle()

AIplayerspeed = 15

# Создадим шарик
pong = Turtle("circle", visible=False)
pong.shapesize(0.5, 0.5)
pong.speed('fast')
pong.color("red")
pong.penup()

pong.sety(265)
pong.showturtle()

pongspeed = 20
pong_dx, pong_dy = 5, -5

# дадим управление игроку
def move_up():
    player.forward(playerspeed)

    y = player.ycor()

    if y > 265:
        y = 260
        player.sety(y)

    screen.update()

def move_down():
    player.backward(playerspeed)

    y = player.ycor()

    if y < -265:
        y = -260
        player.sety(y)

    screen.update()

# Bind'м кнопки для управление
screen.onkey(move_up, "Up")
screen.onkey(move_down, "Down")

screen.listen()

# main game loop
def move():
    global pong_dx, pong_dy, AIplayerspeed, seconds, score

    # move pong ball
    x, y = pong.position()
    x += pong_dx
    y += pong_dy
    pong.setposition(x, y)

    if isCollision(pong, player): # столкновение шарика и игрока
        pong_dx *= -1
        # Обновить счет
        score += 10
        score_pen.undo()
        score_pen.write("Score: {}".format(score), align="left", font=FONT)
    elif isCollision(pong, AIplayer):  # столкновение шарика и AIplayer
        pong_dx *= -1
    elif y < -300 or y > 300:  # check for bounce and redirect it
        pong_dy *= -1
    elif x > 300:
        pong_dx *= -1
    elif x < -300:
        print("Game Over")
        screen.bye()
        return

    # двигаем Паддл игрока, управляемого компьютером
    AIplayer.forward(AIplayerspeed)

    y = AIplayer.ycor()

    if y < -250 or y > 250:
        AIplayerspeed *= -1

    # Отображение таймера
    seconds += 0.05
    time_pen.undo()
    time_pen.write("Time: {}".format(int(seconds)), False, align="Left", font=FONT)
    screen.ontimer(move, 50)

    screen.update()

screen.tracer(False)
move()
screen.mainloop()
